(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var Class=require("klasse");var PointMass=require("verlet3d").PointMass;var Cloth=new Class({initialize:function(width,height,options){options=options||{};this.width=width;this.height=height;this.startX=options.startX||0;this.startY=options.startY||0;this.spacing=options.spacing||5;this.stiffness=typeof options.stiffness==="number"?options.stiffness:.1;this.tearDistance=typeof options.tearDistance==="number"?options.tearDistance:100;this.mass=typeof options.mass==="number"?options.mass:1;this.points=[];this.create()},create:function(){var points=this.points;var spacing=this.spacing;var start_x=this.startX;var start_y=this.startY;var mass=this.mass;var stiff=this.stiffness;var tear=this.tearDistance;var usePins=false;var rows=Math.floor(this.height/spacing);var cols=Math.floor(this.width/spacing);this.rows=rows;this.cols=cols;points.length=0;for(var y=0;y<=rows;y++){for(var x=0;x<=cols;x++){var p=new PointMass(start_x+x*spacing,start_y+y*spacing,0,mass);var edge=!usePins?y===0:y===0||x===0||y===rows||x===cols;if(x!==0)p.attach(points[points.length-1],spacing,stiff,tear);if(edge)p.pin(p.position.x,p.position.y,0);if(y!==0)p.attach(points[x+(y-1)*(cols+1)],spacing,stiff,tear);points.push(p)}}}});module.exports=Cloth},{klasse:23,verlet3d:36}],2:[function(require,module,exports){var Class=require("klasse");var MeshRenderer=require("kami-mesh").MeshRenderer;var domready=require("domready");var ShaderProgram=require("kami").ShaderProgram;var Matrix4=require("vecmath").Matrix4;var OrthographicCamera=require("cam3d").OrthographicCamera;var PerspectiveCamera=require("cam3d").PerspectiveCamera;var Vector3=require("vecmath").Vector3;var Matrix3=require("vecmath").Matrix3;var rot=new Matrix3;var tmpVec=new Vector3;var tmpVec2=new Vector3;var tmpVec3=new Vector3;var ClothRenderer=new Class({initialize:function(context,vert,frag){this.context=context;this.camera=new OrthographicCamera;this.camera.setToOrtho(true,context.width,context.height);this.shader=new ShaderProgram(context,vert,frag);if(this.shader.log)console.warn(this.shader.log);this.time=0;this.mesh=new MeshRenderer(context,{hasColors:true,maxVertices:15e4,hasNormals:true,numTexCoords:1});this.lightPosition=new Vector3},resize:function(width,height){},draw:function(world,width,height){var gl=this.context.gl;var r=this.mesh;var shader=this.shader;var cam=this.camera;this.time+=.1;r.shader=shader;r.begin(cam.combined,gl.TRIANGLES);shader.setUniformi("u_sampler0",0);shader.setUniformi("u_sampler1",1);shader.setUniformf("time",this.time);shader.setUniformf("LightPos",this.lightPosition.x,this.lightPosition.y,this.lightPosition.z);shader.setUniformf("LightColor",1,.8,.8,.6);shader.setUniformf("AmbientColor",.6,.6,1,1);shader.setUniformf("Falloff",.001,1,1);shader.setUniformf("Resolution",this.context.width,this.context.height);for(var i=0;i<world.points.length;i++){var p=world.points[i];if(p.constraints.length>=2){var c=p.constraints;var botLeft=c[0].p2;var topRight=c[1].p2;var index=i;var tri=topRight.constraints.length>0;this.drawTriangle(botLeft.position,topRight.position,p.position,index,width,height);if(tri){c=topRight.constraints;var other=c[0].p2;this.drawTriangle(botLeft.position,other.position,topRight.position,index,width,height,true)}}}r.end();r.begin(cam.combined,gl.LINES);for(var i=0;i<world.points.length;i++){var p=world.points[i];this.drawLines(p)}r.end()},computeNormal:function(a,b,c){tmpVec3.set(a.x,a.y,a.z);tmpVec.copy(b).sub(tmpVec3);tmpVec3.set(a.x,a.y,a.z);tmpVec2.copy(c).sub(tmpVec3);return tmpVec.cross(tmpVec2).normalize()},drawLines:function(p){var r=this.mesh;var a=.2;var color=.5;var n=tmpVec.set(0,0,1);for(var j=0;j<p.constraints.length;j++){var c=p.constraints[j];r.color(color,color,color,a);r.texCoord(0,0);r.normal(n.x,n.y,n.z);r.vertex(c.p1.position.x,c.p1.position.y,c.p1.position.z);r.color(color,color,color,a);r.texCoord(0,0);r.normal(n.x,n.y,n.z);r.vertex(c.p2.position.x,c.p2.position.y,c.p2.position.z)}},drawTriangle:function(p1,p2,p3,i,width,height,flip){var n=this.computeNormal(p1,p2,p3);var a=.7;width++;height++;var y=~~(i/width);var x=~~(i-width*y);var u=x/width;var v=y/height;var uOff=1/width;var vOff=1/height;var r=this.mesh;r.color(a,a,a,1);r.texCoord(u,v);r.normal(n.x,n.y,n.z);r.vertex(p1.x,p1.y,p1.z);r.color(a,a,a,1);if(flip)r.texCoord(u,v-vOff);else r.texCoord(u+uOff,v-vOff);r.normal(n.x,n.y,n.z);r.vertex(p2.x,p2.y,p2.z);r.color(a,a,a,1);if(flip)r.texCoord(u+uOff,v-vOff);else r.texCoord(u+uOff,v);r.normal(n.x,n.y,n.z);r.vertex(p3.x,p3.y,p3.z)}});module.exports=ClothRenderer},{cam3d:6,domready:8,kami:20,"kami-mesh":9,klasse:23,vecmath:32}],3:[function(require,module,exports){var Class=require("klasse");var util=require("./vecutil");var Vector2=require("vecmath").Vector2;var Vector3=require("vecmath").Vector3;var Vector4=require("vecmath").Vector4;var Matrix4=require("vecmath").Matrix4;var tmpVec3=new Vector3;var tmpVec4=new Vector4;var Camera=new Class({initialize:function(){this.direction=new Vector3(0,0,-1);this.up=new Vector3(0,1,0);this.position=new Vector3;this.projection=new Matrix4;this.view=new Matrix4;this.combined=new Matrix4;this.invProjectionView=new Matrix4;this.near=1;this.far=100;this.ray={origin:new Vector3,direction:new Vector3};this.viewportWidth=0;this.viewportHeight=0},translate:function(x,y,z){if(typeof x==="object"){this.position.x+=x.x||0;this.position.y+=x.y||0;this.position.z+=x.z||0}else{this.position.x+=x||0;this.position.y+=y||0;this.position.z+=z||0}},lookAt:function(x,y,z){var dir=this.direction,up=this.up;if(typeof x==="object"){dir.copy(x)}else{dir.set(x,y,z)}dir.sub(this.position).normalize();tmpVec3.copy(dir).cross(up).normalize();up.copy(tmpVec3).cross(dir).normalize()},rotate:function(radians,axis){util.rotate(this.direction,axis,radians);util.rotate(this.up,axis,radians)},rotateAround:function(point,radians,axis){tmpVec.copy(point).sub(this.position);this.translate(tmpVec);this.rotate(radians,axis);this.translate(tmpVec.negate())},project:function(vec,out){if(!out)out=new Vector4;var viewportWidth=this.viewportWidth,viewportHeight=this.viewportHeight,n=Camera.NEAR_RANGE,f=Camera.FAR_RANGE;tmpVec4.set(vec.x,vec.y,vec.z,1);tmpVec4.transformMat4(this.combined);tmpVec4.x=tmpVec4.x/tmpVec4.w;tmpVec4.y=tmpVec4.y/tmpVec4.w;tmpVec4.z=tmpVec4.z/tmpVec4.w;out.x=viewportWidth/2*tmpVec4.x+(0+viewportWidth/2);out.y=viewportHeight/2*tmpVec4.y+(0+viewportHeight/2);out.z=(f-n)/2*tmpVec4.z+(f+n)/2;if(out.w===0||out.w)out.w=1/tmpVec4.w;return out},unproject:function(vec,out){if(!out)out=new Vector3;var viewport=tmpVec4.set(0,0,this.viewportWidth,this.viewportHeight);return out.copy(vec).unproject(viewport,this.invProjectionView)},getPickRay:function(x,y){var origin=this.ray.origin.set(x,y,0),direction=this.ray.direction.set(x,y,1),viewport=tmpVec4.set(0,0,this.viewportWidth,this.viewportHeight),mtx=this.invProjectionView;origin.unproject(viewport,mtx);direction.unproject(viewport,mtx);direction.sub(origin).normalize();return this.ray},update:function(){}});Camera.FAR_RANGE=1;Camera.NEAR_RANGE=0;module.exports=Camera},{"./vecutil":7,klasse:23,vecmath:32}],4:[function(require,module,exports){var Class=require("klasse");var Vector3=require("vecmath").Vector3;var Vector4=require("vecmath").Vector4;var Matrix4=require("vecmath").Matrix4;var Camera=require("./Camera");var tmpVec3=new Vector3;var OrthographicCamera=new Class({Extends:Camera,initialize:function(viewportWidth,viewportHeight){Camera.call(this);this.viewportWidth=viewportWidth;this.viewportHeight=viewportHeight;this.zoom=1;this.near=0;this.update()},setToOrtho:function(yDown,viewportWidth,viewportHeight){var zoom=this.zoom;viewportWidth=typeof viewportWidth==="number"?viewportWidth:this.viewportWidth;viewportHeight=typeof viewportHeight==="number"?viewportHeight:this.viewportHeight;this.up.set(0,yDown?-1:1,0);this.direction.set(0,0,yDown?1:-1);this.position.set(zoom*viewportWidth/2,zoom*viewportHeight/2,0);this.viewportWidth=viewportWidth;this.viewportHeight=viewportHeight;this.update()},update:function(){var w=this.viewportWidth,h=this.viewportHeight,near=Math.abs(this.near),far=Math.abs(this.far),zoom=this.zoom;this.projection.ortho(zoom*-w/2,zoom*w/2,zoom*-h/2,zoom*h/2,near,far);tmpVec3.copy(this.position).add(this.direction);this.view.lookAt(this.position,tmpVec3,this.up);this.combined.copy(this.projection).mul(this.view);this.invProjectionView.copy(this.combined).invert()}});module.exports=OrthographicCamera},{"./Camera":3,klasse:23,vecmath:32}],5:[function(require,module,exports){var Class=require("klasse");var Matrix4=require("vecmath").Matrix4;var Vector2=require("vecmath").Vector2;var Vector3=require("vecmath").Vector3;var Camera=require("./Camera");var tmpVec3=new Vector3;var dirvec=null,rightvec=null,billboardMatrix=null;var PerspectiveCamera=new Class({Extends:Camera,initialize:function(fieldOfView,viewportWidth,viewportHeight){Camera.call(this);this.viewportWidth=viewportWidth;this.viewportHeight=viewportHeight;this.billboardMatrixDirty=true;this.fieldOfView=fieldOfView;this.update()},setViewport:function(width,height){this.viewportWidth=width;this.viewportHeight=height},updateBillboardMatrix:function(){if(!dirvec){dirvec=new Vector3;rightvec=new Vector3;billboardMatrix=new Matrix4}var dir=dirvec.set(this.direction).negate();var right=rightvec.set(this.up).cross(dir).normalize();var up=tmpVec3.set(dir).cross(right).normalize();var out=billboardMatrix.val;out[0]=right.x;out[1]=right.y;out[2]=right.z;out[3]=0;out[4]=up.x;out[5]=up.y;out[6]=up.z;out[7]=0;out[8]=dir.x;out[9]=dir.y;out[10]=dir.z;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;this.billboardMatrixDirty=false},getPointSize:function(vec,size,out){if(!out)out=new Vector2;if(this.billboardMatrixDirty)this.updateBillboardMatrix();var tmp=tmpVec3;var dx=size.x/2;var dy=size.y/2;tmp.set(-dx,-dy,0).transformMat4(billboardMatrix).add(vec);this.project(tmp,tmp);var tlx=tmp.x;var tly=tmp.y;tmp.set(dx,dy,0).transformMat4(billboardMatrix).add(vec);this.project(tmp,tmp);var brx=tmp.x;var bry=tmp.y;var w=Math.abs(brx-tlx);var h=Math.abs(bry-tly);return out.set(w,h)},update:function(){var aspect=this.viewportWidth/this.viewportHeight;this.projection.perspective(this.fieldOfView,aspect,Math.abs(this.near),Math.abs(this.far));tmpVec3.copy(this.position).add(this.direction);this.view.lookAt(this.position,tmpVec3,this.up);this.combined.copy(this.projection).mul(this.view);this.invProjectionView.copy(this.combined).invert();this.billboardMatrixDirty=true}});module.exports=PerspectiveCamera},{"./Camera":3,klasse:23,vecmath:32}],6:[function(require,module,exports){module.exports={vecutil:require("./vecutil"),Camera:require("./Camera"),PerspectiveCamera:require("./PerspectiveCamera"),OrthographicCamera:require("./OrthographicCamera")}},{"./Camera":3,"./OrthographicCamera":4,"./PerspectiveCamera":5,"./vecutil":7}],7:[function(require,module,exports){var Vector3=require("vecmath").Vector3;var Matrix4=require("vecmath").Matrix4;var Quaternion=require("vecmath").Quaternion;var tmpMat4=new Matrix4;var tmpQuat=new Quaternion;var tmpVec3=new Vector3;var util={};util.rotate=function(vec,axis,radians){tmpQuat.setAxisAngle(axis,radians);tmpMat4.fromRotationTranslation(tmpQuat,tmpVec3.set(0,0,0));return vec.transformMat4(tmpMat4)};module.exports=util},{vecmath:32}],8:[function(require,module,exports){!function(name,definition){if(typeof module!="undefined")module.exports=definition();else if(typeof define=="function"&&typeof define.amd=="object")define(definition);else this[name]=definition()}("domready",function(){var fns=[],listener,doc=document,domContentLoaded="DOMContentLoaded",loaded=/^loaded|^i|^c/.test(doc.readyState);if(!loaded)doc.addEventListener(domContentLoaded,listener=function(){doc.removeEventListener(domContentLoaded,listener);loaded=1;while(listener=fns.shift())listener()});return function(fn){loaded?fn():fns.push(fn)}})},{}],9:[function(require,module,exports){module.exports={MeshRenderer:require("./lib/MeshRenderer")}},{"./lib/MeshRenderer":10}],10:[function(require,module,exports){var Class=require("klasse");var Mesh=require("kami").Mesh;var ShaderProgram=require("kami").ShaderProgram;var Matrix4=require("vecmath").Matrix4;var colorToFloat=require("number-util").colorToFloat;var MeshRenderer=new Class({initialize:function(context,options){this.context=context;if(!context)throw new Error("no WebGLContext specified to MeshRenderer");options=options||{};var hasNormals=typeof options.hasNormals!=="undefined"?options.hasNormals:false;var hasColors=typeof options.hasColors!=="undefined"?options.hasColors:false;this.numTexCoords=options.numTexCoords||0;this.maxVertices=typeof options.maxVertices==="number"?options.maxVertices:500;var attribs=this._createVertexAttributes(hasNormals,hasColors);this.mesh=new Mesh(context,false,this.maxVertices,0,attribs);this.normalOffset=hasNormals?3:0;this.colorOffset=hasColors?this.normalOffset+3:0;this.texCoordOffset=this.numTexCoords>0?this.colorOffset+1:0;this.numSetTexCoords=0;this.vertices=this.mesh.vertices;this.vertexSize=this.mesh.vertexStride/4;this.primitiveType=context.gl.TRIANGLES;this.premultiplied=true;this.vertexIdx=0;this.numVertices=0;this.projModelView=new Matrix4;this._shader=MeshRenderer.createDefaultShader(context,hasNormals,hasColors,this.numTexCoords);this.defaultShader=this._shader;this.ownsShader=true},destroy:function(){if(this.ownsShader&&this.defaultShader)this.defaultShader.destroy();if(this.mesh)this.mesh.destroy();this.defaultShader=null;this._shader=null;this.mesh=null;this.context=null},shader:{set:function(val){this._shader=val?val:this.defaultShader;if(this.drawing){this._shader.bind();this.uploadMatrices()}},get:function(){return this._shader}},_createVertexAttributes:function(hasNormals,hasColors){var gl=this.context.gl;var attribs=[new Mesh.Attrib(ShaderProgram.POSITION_ATTRIBUTE,3)];if(hasNormals)attribs.push(new Mesh.Attrib(ShaderProgram.NORMAL_ATTRIBUTE,3));if(hasColors)attribs.push(new Mesh.Attrib(ShaderProgram.COLOR_ATTRIBUTE,4,null,gl.UNSIGNED_BYTE,true,1));for(var i=0;i<this.numTexCoords;i++){attribs.push(new Mesh.Attrib(ShaderProgram.TEXCOORD_ATTRIBUTE+i,2))}return attribs},begin:function(projModelView,primitiveType){if(this.drawing)throw"batch.end() must be called before begin";this.drawing=true;if(projModelView)this.projModelView.set(projModelView);this.primitiveType=typeof primitiveType==="undefined"?this.context.gl.TRIANGLES:primitiveType;var shader=this._shader;shader.bind();this.uploadMatrices()},uploadMatrices:function(){var shader=this._shader;shader.setUniformMatrix4("u_projModelView",this.projModelView);for(var i=0;i<this.numTexCoords;i++){shader.setUniformi("u_sampler"+i,i)}},color:function(r,g,b,a){var rnum=typeof r==="number";if(rnum&&typeof g==="number"&&typeof b==="number"){a=a||a===0?a:1}else{r=g=b=a=rnum?r:1}if(this.premultiplied){r*=a;g*=a;b*=a}var color=colorToFloat(~~(r*255),~~(g*255),~~(b*255),~~(a*255));this.vertices[this.vertexIdx+this.colorOffset]=color},texCoord:function(u,v){var idx=this.vertexIdx+this.texCoordOffset;this.vertices[idx+this.numSetTexCoords]=u||0;this.vertices[idx+this.numSetTexCoords+1]=v||0;this.numSetTexCoords+=2},normal:function(x,y,z){var idx=this.vertexIdx+this.normalOffset;this.vertices[idx]=x||0;this.vertices[idx+1]=y||0;this.vertices[idx+2]=z||0},vertex:function(x,y,z){var idx=this.vertexIdx;this.vertices[idx]=x||0;this.vertices[idx+1]=y||0;this.vertices[idx+2]=z||0;this.numSetTexCoords=0;this.vertexIdx+=this.vertexSize;this.numVertices++},end:function(){if(!this.drawing)throw"renderer.begin() must be called before end";this.drawing=false;if(this.numVertices===0)return;var shader=this._shader,gl=this.context.gl;this.mesh.bind(shader);this.mesh.verticesDirty=true;this.mesh.draw(this.primitiveType,this.vertexIdx*4/this.mesh.vertexStride,0,this.vertexIdx);this.mesh.unbind(shader);this.numSetTexCoords=0;this.vertexIdx=0;this.numVertices=0}});MeshRenderer.createDefaultShader=function(context,hasNormals,hasColors,numTexCoords){var vertSrc=MeshRenderer.createVertexShader(hasNormals,hasColors,numTexCoords);var fragSrc=MeshRenderer.createFragmentShader(hasColors,numTexCoords);return new ShaderProgram(context,vertSrc,fragSrc)};MeshRenderer.createVertexShader=function(hasNormals,hasColors,numTexCoords){numTexCoords=numTexCoords||0;var shader="";shader+="attribute vec4 "+ShaderProgram.POSITION_ATTRIBUTE+";\n"+(hasNormals?"attribute vec3 "+ShaderProgram.NORMAL_ATTRIBUTE+";\n":"")+(hasColors?"attribute vec4 "+ShaderProgram.COLOR_ATTRIBUTE+";\n":"");var i;for(i=0;i<numTexCoords;i++){shader+="attribute vec2 "+ShaderProgram.TEXCOORD_ATTRIBUTE+i+";\n"}shader+="uniform mat4 u_projModelView;\n";shader+=hasColors?"varying vec4 v_col;\n":"";for(i=0;i<numTexCoords;i++){shader+="varying vec2 v_tex"+i+";\n"}shader+="void main() {\n"+"   gl_Position = u_projModelView * "+ShaderProgram.POSITION_ATTRIBUTE+";\n"+(hasColors?"   v_col = "+ShaderProgram.COLOR_ATTRIBUTE+";\n":"");for(i=0;i<numTexCoords;i++){shader+="   v_tex"+i+" = "+ShaderProgram.TEXCOORD_ATTRIBUTE+i+";\n"}shader+="   gl_PointSize = 1.0;\n";shader+="}\n";return shader};MeshRenderer.createFragmentShader=function(hasColors,numTexCoords){numTexCoords=numTexCoords||0;var shader="#ifdef GL_ES\n"+"precision mediump float;\n"+"#endif\n";if(hasColors)shader+="varying vec4 v_col;\n";var i;for(i=0;i<numTexCoords;i++){shader+="varying vec2 v_tex"+i+";\n";shader+="uniform sampler2D u_sampler"+i+";\n"}shader+="void main() {\n"+"   gl_FragColor = "+(hasColors?"v_col":"vec4(1, 1, 1, 1)");if(numTexCoords>0)shader+=" * ";for(i=0;i<numTexCoords;i++){if(i==numTexCoords-1){shader+=" texture2D(u_sampler"+i+",  v_tex"+i+")"}else{shader+=" texture2D(u_sampler"+i+",  v_tex"+i+") *"}}shader+=";\n}";return shader};module.exports=MeshRenderer},{kami:20,klasse:23,"number-util":11,vecmath:32}],11:[function(require,module,exports){var int8=new Int8Array(4);var int32=new Int32Array(int8.buffer,0,1);var float32=new Float32Array(int8.buffer,0,1);var NumberUtil=function(){};NumberUtil.intBitsToFloat=function(i){int32[0]=i;return float32[0]};NumberUtil.floatToIntBits=function(f){float32[0]=f;return int32[0]};NumberUtil.intToFloatColor=function(value){return NumberUtil.intBitsToFloat(value&4278190079)};NumberUtil.colorToFloat=function(r,g,b,a){var bits=a<<24|b<<16|g<<8|r;return NumberUtil.intToFloatColor(bits)};NumberUtil.isPowerOfTwo=function(n){return(n&n-1)===0};NumberUtil.nextPowerOfTwo=function(n){n--;n|=n>>1;n|=n>>2;n|=n>>4;n|=n>>8;n|=n>>16;return n+1};module.exports=NumberUtil},{}],12:[function(require,module,exports){var Class=require("klasse");var Mesh=require("./glutils/Mesh");var colorToFloat=require("number-util").colorToFloat;var BaseBatch=new Class({initialize:function BaseBatch(context,size){if(typeof context!=="object")throw"GL context not specified to SpriteBatch";this.context=context;this.size=size||500;if(this.size>10922)throw"Can't have more than 10922 sprites per batch: "+this.size;this._blendSrc=this.context.gl.ONE;this._blendDst=this.context.gl.ONE_MINUS_SRC_ALPHA;this._blendingEnabled=true;this._shader=this._createShader();this.defaultShader=this._shader;this.ownsShader=true;this.idx=0;this.drawing=false;this.mesh=this._createMesh(this.size);this.color=colorToFloat(255,255,255,255);this.premultiplied=true},blendingEnabled:{set:function(val){var old=this._blendingEnabled;if(this.drawing)this.flush();this._blendingEnabled=val;if(this.drawing&&old!=val){var gl=this.context.gl;if(val)gl.enable(gl.BLEND);else gl.disable(gl.BLEND)}},get:function(){return this._blendingEnabled}},blendSrc:{set:function(val){if(this.drawing)this.flush();this._blendSrc=val},get:function(){return this._blendSrc}},blendDst:{set:function(val){if(this.drawing)this.flush();this._blendDst=val},get:function(){return this._blendDst}},setBlendFunction:function(blendSrc,blendDst){this.blendSrc=blendSrc;this.blendDst=blendDst},shader:{set:function(val){var wasDrawing=this.drawing;if(wasDrawing){this.end()}this._shader=val?val:this.defaultShader;if(wasDrawing){this.begin()}},get:function(){return this._shader}},setColor:function(r,g,b,a){var rnum=typeof r==="number";if(rnum&&typeof g==="number"&&typeof b==="number"){a=a||a===0?a:1}else{r=g=b=a=rnum?r:1}if(this.premultiplied){r*=a;g*=a;b*=a}this.color=colorToFloat(~~(r*255),~~(g*255),~~(b*255),~~(a*255))},_createMesh:function(size){var numVerts=size*4*this.getVertexSize();var numIndices=size*6;var gl=this.context.gl;this.vertices=new Float32Array(numVerts);this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}var mesh=new Mesh(this.context,false,numVerts,numIndices,this._createVertexAttributes());mesh.vertices=this.vertices;mesh.indices=this.indices;mesh.vertexUsage=gl.DYNAMIC_DRAW;mesh.indexUsage=gl.STATIC_DRAW;mesh.dirty=true;return mesh},_createShader:function(){throw"_createShader not implemented"},_createVertexAttributes:function(){throw"_createVertexAttributes not implemented"},getVertexSize:function(){throw"getVertexSize not implemented"},begin:function(){if(this.drawing)throw"batch.end() must be called before begin";this.drawing=true;this.shader.bind();this.mesh.bind(this.shader);if(this._blendingEnabled){var gl=this.context.gl;gl.enable(gl.BLEND)}},end:function(){if(!this.drawing)throw"batch.begin() must be called before end";if(this.idx>0)this.flush();this.drawing=false;this.mesh.unbind(this.shader);if(this._blendingEnabled){var gl=this.context.gl;gl.disable(gl.BLEND)}},_preRender:function(){},flush:function(){if(this.idx===0)return;var gl=this.context.gl;if(this._blendingEnabled){if(this._blendSrc&&this._blendDst)gl.blendFunc(this._blendSrc,this._blendDst)}this._preRender();var numComponents=this.getVertexSize();var spriteCount=this.idx/(numComponents*4);this.mesh.verticesDirty=true;this.mesh.draw(gl.TRIANGLES,spriteCount*6,0,this.idx);this.idx=0},draw:function(texture,x,y,width,height,u1,v1,u2,v2){},drawVertices:function(texture,verts,off){},drawRegion:function(region,x,y,width,height){this.draw(region.texture,x,y,width,height,region.u,region.v,region.u2,region.v2)},destroy:function(){this.vertices=null;this.indices=null;this.size=this.maxVertices=0;if(this.ownsShader&&this.defaultShader)this.defaultShader.destroy();this.defaultShader=null;this._shader=null;if(this.mesh)this.mesh.destroy();this.mesh=null}});module.exports=BaseBatch},{"./glutils/Mesh":18,klasse:23,"number-util":21}],13:[function(require,module,exports){var Class=require("klasse");var BaseBatch=require("./BaseBatch");var Mesh=require("./glutils/Mesh");var ShaderProgram=require("./glutils/ShaderProgram");var SpriteBatch=new Class({Mixins:BaseBatch,initialize:function SpriteBatch(context,size){BaseBatch.call(this,context,size);this.projection=new Float32Array(2);this.projection[0]=this.context.width/2;this.projection[1]=this.context.height/2;this.texture=null},resize:function(width,height){this.setProjection(width/2,height/2)},getVertexSize:function(){return SpriteBatch.VERTEX_SIZE},_createVertexAttributes:function(){var gl=this.context.gl;return[new Mesh.Attrib(ShaderProgram.POSITION_ATTRIBUTE,2),new Mesh.Attrib(ShaderProgram.COLOR_ATTRIBUTE,4,null,gl.UNSIGNED_BYTE,true,1),new Mesh.Attrib(ShaderProgram.TEXCOORD_ATTRIBUTE+"0",2)]},setProjection:function(x,y){var oldX=this.projection[0];var oldY=this.projection[1];this.projection[0]=x;this.projection[1]=y;if(this.drawing&&(x!=oldX||y!=oldY)){this.flush();this._updateMatrices()}},_createShader:function(){var shader=new ShaderProgram(this.context,SpriteBatch.DEFAULT_VERT_SHADER,SpriteBatch.DEFAULT_FRAG_SHADER);if(shader.log)console.warn("Shader Log:\n"+shader.log);return shader},updateMatrices:function(){this.shader.setUniformfv("u_projection",this.projection)},_preRender:function(){if(this.texture)this.texture.bind()},begin:function(){var gl=this.context.gl;BaseBatch.prototype.begin.call(this);this.updateMatrices();this.shader.setUniformi("u_texture0",0);gl.depthMask(false)},end:function(){var gl=this.context.gl;BaseBatch.prototype.end.call(this);gl.depthMask(true)},flush:function(){if(!this.texture)return;if(this.idx===0)return;BaseBatch.prototype.flush.call(this);SpriteBatch.totalRenderCalls++},draw:function(texture,x,y,width,height,u1,v1,u2,v2){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(!texture)return;if(this.texture===null||this.texture.id!==texture.id){this.flush();this.texture=texture}else if(this.idx==this.vertices.length){this.flush()}width=width===0?width:width||texture.width;height=height===0?height:height||texture.height;x=x||0;y=y||0;var x1=x;var x2=x+width;var y1=y;var y2=y+height;u1=u1||0;u2=u2===0?u2:u2||1;v1=v1||0;v2=v2===0?v2:v2||1;var c=this.color;this.vertices[this.idx++]=x1;this.vertices[this.idx++]=y1;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u1;this.vertices[this.idx++]=v1;this.vertices[this.idx++]=x2;this.vertices[this.idx++]=y1;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u2;this.vertices[this.idx++]=v1;this.vertices[this.idx++]=x2;this.vertices[this.idx++]=y2;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u2;this.vertices[this.idx++]=v2;this.vertices[this.idx++]=x1;this.vertices[this.idx++]=y2;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u1;this.vertices[this.idx++]=v2},drawVertices:function(texture,verts,off){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(!texture)return;if(this.texture!=texture){this.flush();this.texture=texture}else if(this.idx==this.vertices.length){this.flush()}off=off||0;this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++]}});SpriteBatch.VERTEX_SIZE=5;SpriteBatch.totalRenderCalls=0;SpriteBatch.DEFAULT_FRAG_SHADER=["precision mediump float;","varying vec2 vTexCoord0;","varying vec4 vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n");SpriteBatch.DEFAULT_VERT_SHADER=["attribute vec2 "+ShaderProgram.POSITION_ATTRIBUTE+";","attribute vec4 "+ShaderProgram.COLOR_ATTRIBUTE+";","attribute vec2 "+ShaderProgram.TEXCOORD_ATTRIBUTE+"0;","uniform vec2 u_projection;","varying vec2 vTexCoord0;","varying vec4 vColor;","void main(void) {","   gl_Position = vec4( "+ShaderProgram.POSITION_ATTRIBUTE+".x / u_projection.x - 1.0, "+ShaderProgram.POSITION_ATTRIBUTE+".y / -u_projection.y + 1.0 , 0.0, 1.0);","   vTexCoord0 = "+ShaderProgram.TEXCOORD_ATTRIBUTE+"0;","   vColor = "+ShaderProgram.COLOR_ATTRIBUTE+";","}"].join("\n");module.exports=SpriteBatch},{"./BaseBatch":12,"./glutils/Mesh":18,"./glutils/ShaderProgram":19,klasse:23}],14:[function(require,module,exports){var Class=require("klasse");var Signal=require("signals");var nextPowerOfTwo=require("number-util").nextPowerOfTwo;var isPowerOfTwo=require("number-util").isPowerOfTwo;var Texture=new Class({initialize:function Texture(context,width,height,format,dataType,data,genMipmaps){if(typeof context!=="object")throw"GL context not specified to Texture";this.context=context;this.id=null;this.target=context.gl.TEXTURE_2D;this.width=0;this.height=0;this.wrapS=Texture.DEFAULT_WRAP;this.wrapT=Texture.DEFAULT_WRAP;this.minFilter=Texture.DEFAULT_FILTER;this.magFilter=Texture.DEFAULT_FILTER;this.managedArgs=Array.prototype.slice.call(arguments,1);this.context.addManagedObject(this);this.create()},setup:function(width,height,format,dataType,data,genMipmaps){var gl=this.gl;if(typeof width==="string"){var img=new Image;var path=arguments[0];var successCB=typeof arguments[1]==="function"?arguments[1]:null;var failCB=typeof arguments[2]==="function"?arguments[2]:null;genMipmaps=!!arguments[3];var self=this;if(Texture.USE_DUMMY_1x1_DATA){self.uploadData(1,1);this.width=this.height=0}img.onload=function(){self.uploadImage(img,undefined,undefined,genMipmaps);if(successCB)successCB()};img.onerror=function(){if(genMipmaps)gl.generateMipmap(gl.TEXTURE_2D);if(failCB)failCB()};img.onabort=function(){if(genMipmaps)gl.generateMipmap(gl.TEXTURE_2D);if(failCB)failCB()};img.src=path}else{this.uploadData(width,height,format,dataType,data,genMipmaps)}},create:function(){this.gl=this.context.gl;var gl=this.gl;this.id=gl.createTexture();this.width=this.height=0;this.target=gl.TEXTURE_2D;this.bind();gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Texture.UNPACK_PREMULTIPLY_ALPHA);gl.pixelStorei(gl.UNPACK_ALIGNMENT,Texture.UNPACK_ALIGNMENT);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,Texture.UNPACK_FLIP_Y);var colorspace=Texture.UNPACK_COLORSPACE_CONVERSION||gl.BROWSER_DEFAULT_WEBGL;gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,colorspace);this.setWrap(this.wrapS,this.wrapT,false);this.setFilter(this.minFilter,this.magFilter,false);if(this.managedArgs.length!==0){this.setup.apply(this,this.managedArgs)}},destroy:function(){if(this.id&&this.gl)this.gl.deleteTexture(this.id);if(this.context)this.context.removeManagedObject(this);this.width=this.height=0;this.id=null;this.managedArgs=null;this.context=null;this.gl=null},setWrap:function(s,t,ignoreBind){if(s&&t){this.wrapS=s;this.wrapT=t}else this.wrapS=this.wrapT=s;this._checkPOT();if(!ignoreBind)this.bind();var gl=this.gl;gl.texParameteri(this.target,gl.TEXTURE_WRAP_S,this.wrapS);gl.texParameteri(this.target,gl.TEXTURE_WRAP_T,this.wrapT)},setFilter:function(min,mag,ignoreBind){if(min&&mag){this.minFilter=min;this.magFilter=mag}else this.minFilter=this.magFilter=min;this._checkPOT();if(!ignoreBind)this.bind();var gl=this.gl;gl.texParameteri(this.target,gl.TEXTURE_MIN_FILTER,this.minFilter);gl.texParameteri(this.target,gl.TEXTURE_MAG_FILTER,this.magFilter)},uploadData:function(width,height,format,type,data,genMipmaps){var gl=this.gl;format=format||gl.RGBA;type=type||gl.UNSIGNED_BYTE;data=data||null;this.width=width||width==0?width:this.width;this.height=height||height==0?height:this.height;this._checkPOT();this.bind();gl.texImage2D(this.target,0,format,this.width,this.height,0,format,type,data);if(genMipmaps)gl.generateMipmap(this.target)},uploadImage:function(domObject,format,type,genMipmaps){var gl=this.gl;format=format||gl.RGBA;type=type||gl.UNSIGNED_BYTE;this.width=domObject.width;this.height=domObject.height;this._checkPOT();this.bind();gl.texImage2D(this.target,0,format,format,type,domObject);if(genMipmaps)gl.generateMipmap(this.target)},_checkPOT:function(){if(!Texture.FORCE_POT){var wrongFilter=this.minFilter!==Texture.Filter.LINEAR&&this.minFilter!==Texture.Filter.NEAREST;var wrongWrap=this.wrapS!==Texture.Wrap.CLAMP_TO_EDGE||this.wrapT!==Texture.Wrap.CLAMP_TO_EDGE;if(wrongFilter||wrongWrap){if(!isPowerOfTwo(this.width)||!isPowerOfTwo(this.height))throw new Error(wrongFilter?"Non-power-of-two textures cannot use mipmapping as filter":"Non-power-of-two textures must use CLAMP_TO_EDGE as wrap")}}},bind:function(unit){var gl=this.gl;if(unit||unit===0)gl.activeTexture(gl.TEXTURE0+unit);
gl.bindTexture(this.target,this.id)},toString:function(){return this.id+":"+this.width+"x"+this.height+""}});Texture.Filter={NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985};Texture.Wrap={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Texture.Format={DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410};Texture.DataType={BYTE:5120,SHORT:5122,INT:5124,FLOAT:5126,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635};Texture.DEFAULT_WRAP=Texture.Wrap.CLAMP_TO_EDGE;Texture.DEFAULT_FILTER=Texture.Filter.NEAREST;Texture.FORCE_POT=false;Texture.UNPACK_FLIP_Y=false;Texture.UNPACK_ALIGNMENT=1;Texture.UNPACK_PREMULTIPLY_ALPHA=true;Texture.UNPACK_COLORSPACE_CONVERSION=undefined;Texture.USE_DUMMY_1x1_DATA=true;Texture.getNumComponents=function(format){switch(format){case Texture.Format.DEPTH_COMPONENT:case Texture.Format.ALPHA:case Texture.Format.LUMINANCE:return 1;case Texture.Format.LUMINANCE_ALPHA:return 2;case Texture.Format.RGB:return 3;case Texture.Format.RGBA:return 4}return null};module.exports=Texture},{klasse:23,"number-util":21,signals:22}],15:[function(require,module,exports){var Class=require("klasse");var Texture=require("./Texture");var TextureRegion=new Class({initialize:function TextureRegion(texture,x,y,width,height){this.texture=texture;this.setRegion(x,y,width,height)},setUVs:function(u,v,u2,v2){this.regionWidth=Math.round(Math.abs(u2-u)*this.texture.width);this.regionHeight=Math.round(Math.abs(v2-v)*this.texture.height);if(this.regionWidth==1&&this.regionHeight==1){var adjustX=.25/this.texture.width;u+=adjustX;u2-=adjustX;var adjustY=.25/this.texture.height;v+=adjustY;v2-=adjustY}this.u=u;this.v=v;this.u2=u2;this.v2=v2},setRegion:function(x,y,width,height){x=x||0;y=y||0;width=width===0||width?width:this.texture.width;height=height===0||height?height:this.texture.height;var invTexWidth=1/this.texture.width;var invTexHeight=1/this.texture.height;this.setUVs(x*invTexWidth,y*invTexHeight,(x+width)*invTexWidth,(y+height)*invTexHeight);this.regionWidth=Math.abs(width);this.regionHeight=Math.abs(height)},setFromRegion:function(region,x,y,width,height){this.texture=region.texture;this.set(region.getRegionX()+x,region.getRegionY()+y,width,height)},regionX:{get:function(){return Math.round(this.u*this.texture.width)}},regionY:{get:function(){return Math.round(this.v*this.texture.height)}},flip:function(x,y){var temp;if(x){temp=this.u;this.u=this.u2;this.u2=temp}if(y){temp=this.v;this.v=this.v2;this.v2=temp}}});module.exports=TextureRegion},{"./Texture":14,klasse:23}],16:[function(require,module,exports){var Class=require("klasse");var Signal=require("signals");var WebGLContext=new Class({initialize:function WebGLContext(width,height,view,contextAttributes){this.managedObjects=[];this.gl=null;this.view=view||document.createElement("canvas");this.width=this.view.width=width||300;this.height=this.view.height=height||150;this.contextAttributes=contextAttributes;this.valid=false;this.lost=new Signal;this.restored=new Signal;this.view.addEventListener("webglcontextlost",function(ev){ev.preventDefault();this._contextLost(ev)}.bind(this));this.view.addEventListener("webglcontextrestored",function(ev){ev.preventDefault();this._contextRestored(ev)}.bind(this));this._initContext();this.resize(this.width,this.height)},_initContext:function(){var err="";this.valid=false;try{this.gl=this.view.getContext("webgl",this.contextAttributes)||this.view.getContext("experimental-webgl",this.contextAttributes)}catch(e){this.gl=null}if(this.gl){this.valid=true}else{throw"WebGL Context Not Supported -- try enabling it or using a different browser"}},resize:function(width,height){this.width=width;this.height=height;this.view.width=width;this.view.height=height;var gl=this.gl;gl.viewport(0,0,this.width,this.height)},addManagedObject:function(obj){this.managedObjects.push(obj)},removeManagedObject:function(obj){var idx=this.managedObjects.indexOf(obj);if(idx>-1){this.managedObjects.splice(idx,1);return obj}return null},destroy:function(){for(var i=0;i<this.managedObjects.length;i++){var obj=this.managedObjects[i];if(obj&&typeof obj.destroy==="function")obj.destroy()}this.managedObjects.length=0;this.valid=false;this.gl=null;this.view=null;this.width=this.height=0},_contextLost:function(ev){this.valid=false;this.lost.dispatch(this)},_contextRestored:function(ev){this._initContext();for(var i=0;i<this.managedObjects.length;i++){this.managedObjects[i].create()}this.resize(this.width,this.height);this.restored.dispatch(this)}});module.exports=WebGLContext},{klasse:23,signals:22}],17:[function(require,module,exports){var Class=require("klasse");var Texture=require("../Texture");var FrameBuffer=new Class({initialize:function FrameBuffer(context,width,height,format){if(typeof context!=="object")throw"GL context not specified to FrameBuffer";this.id=null;this.context=context;this.texture=new Texture(context,width,height,format);this.context.addManagedObject(this);this.create()},width:{get:function(){return this.texture.width}},height:{get:function(){return this.texture.height}},create:function(){this.gl=this.context.gl;var gl=this.gl;var tex=this.texture;tex.bind();this.id=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,this.id);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,tex.target,tex.id,0);var result=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(result!=gl.FRAMEBUFFER_COMPLETE){this.destroy();var err="Framebuffer not complete";switch(result){case gl.FRAMEBUFFER_UNSUPPORTED:throw new Error(err+": unsupported");case gl.INCOMPLETE_DIMENSIONS:throw new Error(err+": incomplete dimensions");case gl.INCOMPLETE_ATTACHMENT:throw new Error(err+": incomplete attachment");case gl.INCOMPLETE_MISSING_ATTACHMENT:throw new Error(err+": missing attachment");default:throw new Error(err)}}gl.bindFramebuffer(gl.FRAMEBUFFER,null)},destroy:function(){var gl=this.gl;if(this.texture)this.texture.destroy();if(this.id&&this.gl)this.gl.deleteFramebuffer(this.id);if(this.context)this.context.removeManagedObject(this);this.id=null;this.gl=null;this.texture=null;this.context=null},begin:function(){var gl=this.gl;gl.viewport(0,0,this.texture.width,this.texture.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.id)},end:function(){var gl=this.gl;gl.viewport(0,0,this.context.width,this.context.height);gl.bindFramebuffer(gl.FRAMEBUFFER,null)}});module.exports=FrameBuffer},{"../Texture":14,klasse:23}],18:[function(require,module,exports){var Class=require("klasse");var Mesh=new Class({dirty:{set:function(val){this.verticesDirty=val;this.indicesDirty=val}},initialize:function Mesh(context,isStatic,numVerts,numIndices,vertexAttribs){if(typeof context!=="object")throw"GL context not specified to Mesh";if(!numVerts)throw"numVerts not specified, must be > 0";this.context=context;this.gl=context.gl;this.numVerts=null;this.numIndices=null;this.vertices=null;this.indices=null;this.vertexBuffer=null;this.indexBuffer=null;this.verticesDirty=true;this.indicesDirty=true;this.indexUsage=null;this.vertexUsage=null;this._vertexAttribs=null;this.vertexStride=null;this.numVerts=numVerts;this.numIndices=numIndices||0;this.vertexUsage=isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW;this.indexUsage=isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW;this._vertexAttribs=vertexAttribs||[];this.indicesDirty=true;this.verticesDirty=true;var totalNumComponents=0;for(var i=0;i<this._vertexAttribs.length;i++)totalNumComponents+=this._vertexAttribs[i].offsetCount;this.vertexStride=totalNumComponents*4;this.vertices=new Float32Array(this.numVerts);this.indices=new Uint16Array(this.numIndices);this.context.addManagedObject(this);this.create()},create:function(){this.gl=this.context.gl;var gl=this.gl;this.vertexBuffer=gl.createBuffer();this.indexBuffer=this.numIndices>0?gl.createBuffer():null;this.dirty=true},destroy:function(){this.vertices=null;this.indices=null;if(this.vertexBuffer&&this.gl)this.gl.deleteBuffer(this.vertexBuffer);if(this.indexBuffer&&this.gl)this.gl.deleteBuffer(this.indexBuffer);this.vertexBuffer=null;this.indexBuffer=null;if(this.context)this.context.removeManagedObject(this);this.gl=null;this.context=null},_updateBuffers:function(ignoreBind,subDataLength){var gl=this.gl;if(this.numIndices>0){if(!ignoreBind)gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);if(this.indicesDirty){gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,this.indexUsage);this.indicesDirty=false}}if(!ignoreBind)gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);if(this.verticesDirty){if(subDataLength){var view=this.vertices.subarray(0,subDataLength);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}else{gl.bufferData(gl.ARRAY_BUFFER,this.vertices,this.vertexUsage)}this.verticesDirty=false}},draw:function(primitiveType,count,offset,subDataLength){if(count===0)return;var gl=this.gl;offset=offset||0;this._updateBuffers(true,subDataLength);if(this.numIndices>0){gl.drawElements(primitiveType,count,gl.UNSIGNED_SHORT,offset*2)}else gl.drawArrays(primitiveType,offset,count)},bind:function(shader){var gl=this.gl;var offset=0;var stride=this.vertexStride;this._updateBuffers();for(var i=0;i<this._vertexAttribs.length;i++){var a=this._vertexAttribs[i];var aloc=a.location1;var loc=aloc===null?shader.getAttributeLocation(a.name):a.location1;gl.enableVertexAttribArray(loc);gl.vertexAttribPointer(loc,a.numComponents,a.type||gl.FLOAT,a.normalize,stride,offset);offset+=a.offsetCount*4}},unbind:function(shader){var gl=this.gl;for(var i=0;i<this._vertexAttribs.length;i++){var a=this._vertexAttribs[i];var aloc=a.location1;var loc=aloc===null?shader.getAttributeLocation(a.name):a.location1;gl.disableVertexAttribArray(loc)}}});Mesh.Attrib=new Class({name:null,numComponents:null,location1:null,type:null,initialize:function(name,numComponents,location1,type,normalize,offsetCount){this.name=name;this.numComponents=numComponents;this.location1=typeof location1==="number"?location1:null;this.type=type;this.normalize=Boolean(normalize);this.offsetCount=typeof offsetCount==="number"?offsetCount:this.numComponents}});module.exports=Mesh},{klasse:23}],19:[function(require,module,exports){var Class=require("klasse");var ShaderProgram=new Class({initialize:function ShaderProgram(context,vertSource,fragSource,attributeLocations){if(!vertSource||!fragSource)throw"vertex and fragment shaders must be defined";if(typeof context!=="object")throw"GL context not specified to ShaderProgram";this.context=context;this.vertShader=null;this.fragShader=null;this.program=null;this.log="";this.uniformCache=null;this.attributeCache=null;this.attributeLocations=attributeLocations;this.vertSource=vertSource.trim();this.fragSource=fragSource.trim();this.context.addManagedObject(this);this.create()},create:function(){this.gl=this.context.gl;this._compileShaders()},_compileShaders:function(){var gl=this.gl;this.log="";this.vertShader=this._loadShader(gl.VERTEX_SHADER,this.vertSource);this.fragShader=this._loadShader(gl.FRAGMENT_SHADER,this.fragSource);if(!this.vertShader||!this.fragShader)throw"Error returned when calling createShader";this.program=gl.createProgram();gl.attachShader(this.program,this.vertShader);gl.attachShader(this.program,this.fragShader);if(this.attributeLocations){for(var key in this.attributeLocations){if(this.attributeLocations.hasOwnProperty(key)){gl.bindAttribLocation(this.program,Math.floor(this.attributeLocations[key]),key)}}}gl.linkProgram(this.program);this.log+=gl.getProgramInfoLog(this.program)||"";if(!gl.getProgramParameter(this.program,gl.LINK_STATUS)){throw"Error linking the shader program:\n"+this.log}this._fetchUniforms();this._fetchAttributes()},_fetchUniforms:function(){var gl=this.gl;this.uniformCache={};var len=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);if(!len)return;for(var i=0;i<len;i++){var info=gl.getActiveUniform(this.program,i);if(info===null)continue;var name=info.name;var location1=gl.getUniformLocation(this.program,name);this.uniformCache[name]={size:info.size,type:info.type,location1:location1}}},_fetchAttributes:function(){var gl=this.gl;this.attributeCache={};var len=gl.getProgramParameter(this.program,gl.ACTIVE_ATTRIBUTES);if(!len)return;for(var i=0;i<len;i++){var info=gl.getActiveAttrib(this.program,i);if(info===null)continue;var name=info.name;var location1=gl.getAttribLocation(this.program,name);this.attributeCache[name]={size:info.size,type:info.type,location1:location1}}},_loadShader:function(type,source){var gl=this.gl;var shader=gl.createShader(type);if(!shader)return-1;gl.shaderSource(shader,source);gl.compileShader(shader);var logResult=gl.getShaderInfoLog(shader)||"";if(logResult){var typeStr=type===gl.VERTEX_SHADER?"vertex":"fragment";logResult="Error compiling "+typeStr+" shader:\n"+logResult}this.log+=logResult;if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){throw this.log}return shader},bind:function(){this.gl.useProgram(this.program)},destroy:function(){if(this.context)this.context.removeManagedObject(this);if(this.gl){var gl=this.gl;gl.detachShader(this.vertShader);gl.detachShader(this.fragShader);gl.deleteShader(this.vertShader);gl.deleteShader(this.fragShader);gl.deleteProgram(this.program)}this.attributeCache=null;this.uniformCache=null;this.vertShader=null;this.fragShader=null;this.program=null;this.gl=null;this.context=null},getUniformInfo:function(name){return this.uniformCache[name]||null},getAttributeInfo:function(name){return this.attributeCache[name]||null},getAttributeLocation:function(name){var info=this.getAttributeInfo(name);return info?info.location1:null},getUniformLocation:function(name){var info=this.getUniformInfo(name);return info?info.location1:null},hasUniform:function(name){return this.getUniformInfo(name)!==null},hasAttribute:function(name){return this.getAttributeInfo(name)!==null},getUniform:function(name){return this.gl.getUniform(this.program,this.getUniformLocation(name))},getUniformAt:function(location1){return this.gl.getUniform(this.program,location1)},setUniformi:function(name,x,y,z,w){var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(arguments.length){case 2:gl.uniform1i(loc,x);return true;case 3:gl.uniform2i(loc,x,y);return true;case 4:gl.uniform3i(loc,x,y,z);return true;case 5:gl.uniform4i(loc,x,y,z,w);return true;default:throw"invalid arguments to setUniformi"}},setUniformf:function(name,x,y,z,w){var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(arguments.length){case 2:gl.uniform1f(loc,x);return true;case 3:gl.uniform2f(loc,x,y);return true;case 4:gl.uniform3f(loc,x,y,z);return true;case 5:gl.uniform4f(loc,x,y,z,w);return true;default:throw"invalid arguments to setUniformf"}},setUniformfv:function(name,arrayBuffer,count){count=count||arrayBuffer.length;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(count){case 1:gl.uniform1fv(loc,arrayBuffer);return true;case 2:gl.uniform2fv(loc,arrayBuffer);return true;case 3:gl.uniform3fv(loc,arrayBuffer);return true;case 4:gl.uniform4fv(loc,arrayBuffer);return true;default:throw"invalid arguments to setUniformf"}},setUniformiv:function(name,arrayBuffer,count){count=count||arrayBuffer.length;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(count){case 1:gl.uniform1iv(loc,arrayBuffer);return true;case 2:gl.uniform2iv(loc,arrayBuffer);return true;case 3:gl.uniform3iv(loc,arrayBuffer);return true;case 4:gl.uniform4iv(loc,arrayBuffer);return true;default:throw"invalid arguments to setUniformf"}},setUniformMatrix3:function(name,mat,transpose){var arr=typeof mat==="object"&&mat.val?mat.val:mat;transpose=!!transpose;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;gl.uniformMatrix3fv(loc,transpose,arr)},setUniformMatrix4:function(name,mat,transpose){var arr=typeof mat==="object"&&mat.val?mat.val:mat;transpose=!!transpose;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;gl.uniformMatrix4fv(loc,transpose,arr)}});ShaderProgram.POSITION_ATTRIBUTE="Position";ShaderProgram.NORMAL_ATTRIBUTE="Normal";ShaderProgram.COLOR_ATTRIBUTE="Color";ShaderProgram.TEXCOORD_ATTRIBUTE="TexCoord";module.exports=ShaderProgram},{klasse:23}],20:[function(require,module,exports){module.exports={BaseBatch:require("./BaseBatch.js"),SpriteBatch:require("./SpriteBatch.js"),Texture:require("./Texture.js"),TextureRegion:require("./TextureRegion.js"),WebGLContext:require("./WebGLContext.js"),FrameBuffer:require("./glutils/FrameBuffer.js"),Mesh:require("./glutils/Mesh.js"),ShaderProgram:require("./glutils/ShaderProgram.js")}},{"./BaseBatch.js":12,"./SpriteBatch.js":13,"./Texture.js":14,"./TextureRegion.js":15,"./WebGLContext.js":16,"./glutils/FrameBuffer.js":17,"./glutils/Mesh.js":18,"./glutils/ShaderProgram.js":19}],21:[function(require,module,exports){module.exports=require(11)},{}],22:[function(require,module,exports){(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function validateListener(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}}function Signal(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}Signal.prototype={VERSION:"1.0.0",memorize:false,_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){validateListener(listener,"add");return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){validateListener(listener,"addOnce");return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length,bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal;if(typeof define==="function"&&define.amd){define(function(){return signals})}else if(typeof module!=="undefined"&&module.exports){module.exports=signals}else{global["signals"]=signals}})(this)},{}],23:[function(require,module,exports){function hasGetterOrSetter(def){return!!def.get&&typeof def.get==="function"||!!def.set&&typeof def.set==="function"}function getProperty(definition,k,isClassDescriptor){var def=isClassDescriptor?definition[k]:Object.getOwnPropertyDescriptor(definition,k);if(!isClassDescriptor&&def.value&&typeof def.value==="object"){def=def.value}if(def&&hasGetterOrSetter(def)){if(typeof def.enumerable==="undefined")def.enumerable=true;if(typeof def.configurable==="undefined")def.configurable=true;return def}else{return false}}function hasNonConfigurable(obj,k){var prop=Object.getOwnPropertyDescriptor(obj,k);if(!prop)return false;if(prop.value&&typeof prop.value==="object")prop=prop.value;if(prop.configurable===false)return true;return false}function extend(ctor,definition,isClassDescriptor,extend){for(var k in definition){if(!definition.hasOwnProperty(k))continue;var def=getProperty(definition,k,isClassDescriptor);if(def!==false){var parent=extend||ctor;if(hasNonConfigurable(parent.prototype,k)){if(Class.ignoreFinals)continue;throw new Error("cannot override final property '"+k+"', set Class.ignoreFinals = true to skip")}Object.defineProperty(ctor.prototype,k,def)}else{ctor.prototype[k]=definition[k]}}}function mixin(myClass,mixins){if(!mixins)return;if(!Array.isArray(mixins))mixins=[mixins];for(var i=0;i<mixins.length;i++){extend(myClass,mixins[i].prototype||mixins[i])}}function Class(definition){if(!definition)definition={};var initialize;var Extends;if(definition.initialize){if(typeof definition.initialize!=="function")throw new Error("initialize must be a function");initialize=definition.initialize;delete definition.initialize}else{if(definition.Extends){var base=definition.Extends;initialize=function(){base.apply(this,arguments)}}else{initialize=function(){}}}if(definition.Extends){initialize.prototype=Object.create(definition.Extends.prototype);initialize.prototype.constructor=initialize;Extends=definition.Extends;delete definition.Extends}else{initialize.prototype.constructor=initialize}var mixins=null;if(definition.Mixins){mixins=definition.Mixins;delete definition.Mixins}mixin(initialize,mixins);extend(initialize,definition,true,Extends);return initialize}Class.extend=extend;Class.mixin=mixin;Class.ignoreFinals=false;module.exports=Class},{}],24:[function(require,module,exports){(function(window){var lastTime=0,vendors=["webkit","moz"],requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,i=vendors.length;while(--i>=0&&!requestAnimationFrame){requestAnimationFrame=window[vendors[i]+"RequestAnimationFrame"];cancelAnimationFrame=window[vendors[i]+"CancelAnimationFrame"]}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function(callback){var now=Date.now(),nextTime=Math.max(lastTime+16,now);return setTimeout(function(){callback(lastTime=nextTime)},nextTime-now)};cancelAnimationFrame=clearTimeout}window.requestAnimationFrame=requestAnimationFrame;window.cancelAnimationFrame=cancelAnimationFrame})(window)},{}],25:[function(require,module,exports){var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;function Matrix3(m){this.val=new ARRAY_TYPE(9);if(m){this.copy(m)}else{this.idt()}}var mat3=Matrix3.prototype;mat3.clone=function(){return new Matrix3(this)};mat3.set=function(otherMat){return this.copy(otherMat)};mat3.copy=function(otherMat){var out=this.val,a=otherMat.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this};mat3.fromMat4=function(m){var a=m.val,out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return this};mat3.fromArray=function(a){var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this};mat3.identity=function(){var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return this};mat3.transpose=function(){var a=this.val,a01=a[1],a02=a[2],a12=a[5];a[1]=a[3];a[2]=a[6];a[3]=a01;a[5]=a[7];a[6]=a02;a[7]=a12;return this};mat3.invert=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;a[0]=b01*det;a[1]=(-a22*a01+a02*a21)*det;a[2]=(a12*a01-a02*a11)*det;a[3]=b11*det;a[4]=(a22*a00-a02*a20)*det;a[5]=(-a12*a00+a02*a10)*det;a[6]=b21*det;a[7]=(-a21*a00+a01*a20)*det;a[8]=(a11*a00-a01*a10)*det;return this};mat3.adjoint=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];a[0]=a11*a22-a12*a21;a[1]=a02*a21-a01*a22;a[2]=a01*a12-a02*a11;a[3]=a12*a20-a10*a22;a[4]=a00*a22-a02*a20;a[5]=a02*a10-a00*a12;a[6]=a10*a21-a11*a20;a[7]=a01*a20-a00*a21;a[8]=a00*a11-a01*a10;return this};mat3.determinant=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(otherMat){var a=this.val,b=otherMat.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];a[0]=b00*a00+b01*a10+b02*a20;a[1]=b00*a01+b01*a11+b02*a21;a[2]=b00*a02+b01*a12+b02*a22;a[3]=b10*a00+b11*a10+b12*a20;a[4]=b10*a01+b11*a11+b12*a21;a[5]=b10*a02+b11*a12+b12*a22;a[6]=b20*a00+b21*a10+b22*a20;a[7]=b20*a01+b21*a11+b22*a21;a[8]=b20*a02+b21*a12+b22*a22;return this};mat3.translate=function(v){var a=this.val,x=v.x,y=v.y;a[6]=x*a[0]+y*a[3]+a[6];a[7]=x*a[1]+y*a[4]+a[7];a[8]=x*a[2]+y*a[5]+a[8];return this};mat3.rotate=function(rad){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],s=Math.sin(rad),c=Math.cos(rad);a[0]=c*a00+s*a10;a[1]=c*a01+s*a11;a[2]=c*a02+s*a12;a[3]=c*a10-s*a00;a[4]=c*a11-s*a01;a[5]=c*a12-s*a02;return this};mat3.scale=function(v){var a=this.val,x=v.x,y=v.y;a[0]=x*a[0];a[1]=x*a[1];a[2]=x*a[2];a[3]=y*a[3];a[4]=y*a[4];a[5]=y*a[5];return this};mat3.fromQuat=function(q){var x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,out=this.val;out[0]=1-(yy+zz);out[3]=xy+wz;out[6]=xz-wy;out[1]=xy-wz;out[4]=1-(xx+zz);out[7]=yz+wx;out[2]=xz+wy;out[5]=yz-wx;out[8]=1-(xx+yy);return this};mat3.normalFromMat4=function(m){var a=m.val,out=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return this};mat3.mul=mat3.multiply;mat3.idt=mat3.identity;mat3.reset=mat3.idt;mat3.toString=function(){var a=this.val;return"Matrix3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.str=mat3.toString;module.exports=Matrix3},{}],26:[function(require,module,exports){var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;var EPSILON=1e-6;function Matrix4(m){this.val=new ARRAY_TYPE(16);if(m){this.copy(m)}else{this.idt()}}var mat4=Matrix4.prototype;mat4.clone=function(){return new Matrix4(this)};mat4.set=function(otherMat){return this.copy(otherMat)};mat4.copy=function(otherMat){var out=this.val,a=otherMat.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this};mat4.fromArray=function(a){var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this};mat4.identity=function(){var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this};mat4.transpose=function(){var a=this.val,a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=a01;a[6]=a[9];a[7]=a[13];a[8]=a02;a[9]=a12;a[11]=a[14];a[12]=a03;a[13]=a13;a[14]=a23;return this};mat4.invert=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;a[0]=(a11*b11-a12*b10+a13*b09)*det;a[1]=(a02*b10-a01*b11-a03*b09)*det;a[2]=(a31*b05-a32*b04+a33*b03)*det;a[3]=(a22*b04-a21*b05-a23*b03)*det;a[4]=(a12*b08-a10*b11-a13*b07)*det;a[5]=(a00*b11-a02*b08+a03*b07)*det;a[6]=(a32*b02-a30*b05-a33*b01)*det;a[7]=(a20*b05-a22*b02+a23*b01)*det;a[8]=(a10*b10-a11*b08+a13*b06)*det;a[9]=(a01*b08-a00*b10-a03*b06)*det;a[10]=(a30*b04-a31*b02+a33*b00)*det;a[11]=(a21*b02-a20*b04-a23*b00)*det;a[12]=(a11*b07-a10*b09-a12*b06)*det;a[13]=(a00*b09-a01*b07+a02*b06)*det;a[14]=(a31*b01-a30*b03-a32*b00)*det;a[15]=(a20*b03-a21*b01+a22*b00)*det;return this};mat4.adjoint=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];a[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);a[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));a[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);a[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));a[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));a[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);a[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));a[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);a[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);a[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));a[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);a[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));
a[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));a[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);a[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));a[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return this};mat4.determinant=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.multiply=function(otherMat){var a=this.val,b=otherMat.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];a[0]=b0*a00+b1*a10+b2*a20+b3*a30;a[1]=b0*a01+b1*a11+b2*a21+b3*a31;a[2]=b0*a02+b1*a12+b2*a22+b3*a32;a[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];a[4]=b0*a00+b1*a10+b2*a20+b3*a30;a[5]=b0*a01+b1*a11+b2*a21+b3*a31;a[6]=b0*a02+b1*a12+b2*a22+b3*a32;a[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];a[8]=b0*a00+b1*a10+b2*a20+b3*a30;a[9]=b0*a01+b1*a11+b2*a21+b3*a31;a[10]=b0*a02+b1*a12+b2*a22+b3*a32;a[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];a[12]=b0*a00+b1*a10+b2*a20+b3*a30;a[13]=b0*a01+b1*a11+b2*a21+b3*a31;a[14]=b0*a02+b1*a12+b2*a22+b3*a32;a[15]=b0*a03+b1*a13+b2*a23+b3*a33;return this};mat4.translate=function(v){var x=v.x,y=v.y,z=v.z,a=this.val;a[12]=a[0]*x+a[4]*y+a[8]*z+a[12];a[13]=a[1]*x+a[5]*y+a[9]*z+a[13];a[14]=a[2]*x+a[6]*y+a[10]*z+a[14];a[15]=a[3]*x+a[7]*y+a[11]*z+a[15];return this};mat4.scale=function(v){var x=v.x,y=v.y,z=v.z,a=this.val;a[0]=a[0]*x;a[1]=a[1]*x;a[2]=a[2]*x;a[3]=a[3]*x;a[4]=a[4]*y;a[5]=a[5]*y;a[6]=a[6]*y;a[7]=a[7]*y;a[8]=a[8]*z;a[9]=a[9]*z;a[10]=a[10]*z;a[11]=a[11]*z;a[12]=a[12];a[13]=a[13];a[14]=a[14];a[15]=a[15];return this};mat4.rotate=function(rad,axis){var a=this.val,x=axis.x,y=axis.y,z=axis.z,len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;a[0]=a00*b00+a10*b01+a20*b02;a[1]=a01*b00+a11*b01+a21*b02;a[2]=a02*b00+a12*b01+a22*b02;a[3]=a03*b00+a13*b01+a23*b02;a[4]=a00*b10+a10*b11+a20*b12;a[5]=a01*b10+a11*b11+a21*b12;a[6]=a02*b10+a12*b11+a22*b12;a[7]=a03*b10+a13*b11+a23*b12;a[8]=a00*b20+a10*b21+a20*b22;a[9]=a01*b20+a11*b21+a21*b22;a[10]=a02*b20+a12*b21+a22*b22;a[11]=a03*b20+a13*b21+a23*b22;return this};mat4.rotateX=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a[4]=a10*c+a20*s;a[5]=a11*c+a21*s;a[6]=a12*c+a22*s;a[7]=a13*c+a23*s;a[8]=a20*c-a10*s;a[9]=a21*c-a11*s;a[10]=a22*c-a12*s;a[11]=a23*c-a13*s;return this};mat4.rotateY=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a[0]=a00*c-a20*s;a[1]=a01*c-a21*s;a[2]=a02*c-a22*s;a[3]=a03*c-a23*s;a[8]=a00*s+a20*c;a[9]=a01*s+a21*c;a[10]=a02*s+a22*c;a[11]=a03*s+a23*c;return this};mat4.rotateZ=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];a[0]=a00*c+a10*s;a[1]=a01*c+a11*s;a[2]=a02*c+a12*s;a[3]=a03*c+a13*s;a[4]=a10*c-a00*s;a[5]=a11*c-a01*s;a[6]=a12*c-a02*s;a[7]=a13*c-a03*s;return this};mat4.fromRotationTranslation=function(q,v){var out=this.val,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v.x;out[13]=v.y;out[14]=v.z;out[15]=1;return this};mat4.fromQuat=function(q){var out=this.val,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this};mat4.frustum=function(left,right,bottom,top,near,far){var out=this.val,rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return this};mat4.perspective=function(fovy,aspect,near,far){var out=this.val,f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return this};mat4.ortho=function(left,right,bottom,top,near,far){var out=this.val,lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return this};mat4.lookAt=function(eye,center,up){var out=this.val,x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye.x,eyey=eye.y,eyez=eye.z,upx=up.x,upy=up.y,upz=up.z,centerx=center.x,centery=center.y,centerz=center.z;if(Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON){return this.identity()}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return this};mat4.mul=mat4.multiply;mat4.idt=mat4.identity;mat4.reset=mat4.idt;mat4.toString=function(){var a=this.val;return"Matrix4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};mat4.str=mat4.toString;module.exports=Matrix4},{}],27:[function(require,module,exports){var Vector3=require("./Vector3");var Matrix3=require("./Matrix3");var common=require("./common");var s_iNext=typeof Int8Array!=="undefined"?new Int8Array([1,2,0]):[1,2,0];var tmp=typeof Float32Array!=="undefined"?new Float32Array([0,0,0]):[0,0,0];var xUnitVec3=new Vector3(1,0,0);var yUnitVec3=new Vector3(0,1,0);var tmpvec=new Vector3;var tmpMat3=new Matrix3;function Quaternion(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}}var quat=Quaternion.prototype;for(var k in common){quat[k]=common[k]}quat.rotationTo=function(a,b){var dot=a.x*b.x+a.y*b.y+a.z*b.z;if(dot<-.999999){if(tmpvec.copy(xUnitVec3).cross(a).len()<1e-6)tmpvec.copy(yUnitVec3).cross(a);tmpvec.normalize();return this.setAxisAngle(tmpvec,Math.PI)}else if(dot>.999999){this.x=0;this.y=0;this.z=0;this.w=1;return this}else{tmpvec.copy(a).cross(b);this.x=tmpvec.x;this.y=tmpvec.y;this.z=tmpvec.z;this.w=1+dot;return this.normalize()}};quat.setAxes=function(view,right,up){var m=tmpMat3.val;m[0]=right.x;m[3]=right.y;m[6]=right.z;m[1]=up.x;m[4]=up.y;m[7]=up.z;m[2]=-view.x;m[5]=-view.y;m[8]=-view.z;return this.fromMat3(tmpMat3).normalize()};quat.identity=function(){this.x=this.y=this.z=0;this.w=1;return this};quat.setAxisAngle=function(axis,rad){rad=rad*.5;var s=Math.sin(rad);this.x=s*axis.x;this.y=s*axis.y;this.z=s*axis.z;this.w=Math.cos(rad);return this};quat.multiply=function(b){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=b.x,by=b.y,bz=b.z,bw=b.w;this.x=ax*bw+aw*bx+ay*bz-az*by;this.y=ay*bw+aw*by+az*bx-ax*bz;this.z=az*bw+aw*bz+ax*by-ay*bx;this.w=aw*bw-ax*bx-ay*by-az*bz;return this};quat.slerp=function(b,t){var ax=this.x,ay=this.y,az=this.y,aw=this.y,bx=b.x,by=b.y,bz=b.z,bw=b.w;var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}this.x=scale0*ax+scale1*bx;this.y=scale0*ay+scale1*by;this.z=scale0*az+scale1*bz;this.w=scale0*aw+scale1*bw;return this};quat.invert=function(){var a0=this.x,a1=this.y,a2=this.z,a3=this.w,dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;this.x=-a0*invDot;this.y=-a1*invDot;this.z=-a2*invDot;this.w=a3*invDot;return this};quat.conjugate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};quat.rotateX=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw+aw*bx;this.y=ay*bw+az*bx;this.z=az*bw-ay*bx;this.w=aw*bw-ax*bx;return this};quat.rotateY=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,by=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw-az*by;this.y=ay*bw+aw*by;this.z=az*bw+ax*by;this.w=aw*bw-ay*by;return this};quat.rotateZ=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,bz=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw+ay*bz;this.y=ay*bw-ax*bz;this.z=az*bw+aw*bz;this.w=aw*bw-az*bz;return this};quat.calculateW=function(){var x=this.x,y=this.y,z=this.z;this.x=x;this.y=y;this.z=z;this.w=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return this};quat.fromMat3=function(mat){var m=mat.val,fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);this.w=.5*fRoot;fRoot=.5/fRoot;this.x=(m[7]-m[5])*fRoot;this.y=(m[2]-m[6])*fRoot;this.z=(m[3]-m[1])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=s_iNext[i];var k=s_iNext[j];fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);tmp[i]=.5*fRoot;fRoot=.5/fRoot;tmp[j]=(m[j*3+i]+m[i*3+j])*fRoot;tmp[k]=(m[k*3+i]+m[i*3+k])*fRoot;this.x=tmp[0];this.y=tmp[1];this.z=tmp[2];this.w=(m[k*3+j]-m[j*3+k])*fRoot}return this};quat.idt=quat.identity;quat.sub=quat.subtract;quat.mul=quat.multiply;quat.len=quat.length;quat.lenSq=quat.lengthSq;quat.reset=quat.idt;quat.toString=function(){return"Quaternion("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};quat.str=quat.toString;module.exports=Quaternion},{"./Matrix3":25,"./Vector3":29,"./common":31}],28:[function(require,module,exports){function Vector2(x,y){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0}else{this.x=x||0;this.y=y||0}}var vec2=Vector2.prototype;vec2.clone=function(){return new Vector2(this.x,this.y)};vec2.copy=function(otherVec){this.x=otherVec.x||0;this.y=otherVec.y||0;return this};vec2.set=function(x,y){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0}else{this.x=x||0;this.y=y||0}return this};vec2.add=function(v){this.x+=v.x;this.y+=v.y;return this};vec2.subtract=function(v){this.x-=v.x;this.y-=v.y;return this};vec2.multiply=function(v){this.x*=v.x;this.y*=v.y;return this};vec2.scale=function(s){this.x*=s;this.y*=s;return this};vec2.divide=function(v){this.x/=v.x;this.y/=v.y;return this};vec2.negate=function(){this.x=-this.x;this.y=-this.y;return this};vec2.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y;return Math.sqrt(dx*dx+dy*dy)};vec2.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y;return dx*dx+dy*dy};vec2.length=function(){var x=this.x,y=this.y;return Math.sqrt(x*x+y*y)};vec2.lengthSq=function(){var x=this.x,y=this.y;return x*x+y*y};vec2.normalize=function(){var x=this.x,y=this.y;var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len}return this};vec2.dot=function(v){return this.x*v.x+this.y*v.y};vec2.cross=function(v){return this.x*v.y-this.y*v.x};vec2.lerp=function(v,t){var ax=this.x,ay=this.y;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);return this};vec2.transformMat3=function(mat){var x=this.x,y=this.y,m=mat.val;this.x=m[0]*x+m[2]*y+m[4];this.y=m[1]*x+m[3]*y+m[5];return this};vec2.transformMat4=function(mat){var x=this.x,y=this.y,m=mat.val;this.x=m[0]*x+m[4]*y+m[12];this.y=m[1]*x+m[5]*y+m[13];return this};vec2.reset=function(){this.x=0;this.y=0;return this};vec2.sub=vec2.subtract;vec2.mul=vec2.multiply;vec2.div=vec2.divide;vec2.dist=vec2.distance;vec2.distSq=vec2.distanceSq;vec2.len=vec2.length;vec2.lenSq=vec2.lengthSq;vec2.toString=function(){return"Vector2("+this.x+", "+this.y+")"};vec2.random=function(scale){scale=scale||1;var r=Math.random()*2*Math.PI;this.x=Math.cos(r)*scale;this.y=Math.sin(r)*scale;return this};vec2.str=vec2.toString;module.exports=Vector2},{}],29:[function(require,module,exports){function Vector3(x,y,z){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0}else{this.x=x||0;this.y=y||0;this.z=z||0}}var vec3=Vector3.prototype;vec3.clone=function(){return new Vector3(this.x,this.y,this.z)};vec3.copy=function(otherVec){this.x=otherVec.x;this.y=otherVec.y;this.z=otherVec.z;return this};vec3.set=function(x,y,z){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0}else{this.x=x||0;this.y=y||0;this.z=z||0}return this};vec3.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this};vec3.subtract=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this};vec3.multiply=function(v){this.x*=v.x;this.y*=v.y;this.z*=v.z;return this};vec3.scale=function(s){this.x*=s;this.y*=s;this.z*=s;return this};vec3.divide=function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this};vec3.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};vec3.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z;return Math.sqrt(dx*dx+dy*dy+dz*dz)};vec3.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z;return dx*dx+dy*dy+dz*dz};vec3.length=function(){var x=this.x,y=this.y,z=this.z;return Math.sqrt(x*x+y*y+z*z)};vec3.lengthSq=function(){var x=this.x,y=this.y,z=this.z;return x*x+y*y+z*z};vec3.normalize=function(){var x=this.x,y=this.y,z=this.z;var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len}return this};vec3.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z};vec3.cross=function(v){var ax=this.x,ay=this.y,az=this.z,bx=v.x,by=v.y,bz=v.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this};vec3.lerp=function(v,t){var ax=this.x,ay=this.y,az=this.z;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);return this};vec3.transformMat4=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val;this.x=m[0]*x+m[4]*y+m[8]*z+m[12];this.y=m[1]*x+m[5]*y+m[9]*z+m[13];this.z=m[2]*x+m[6]*y+m[10]*z+m[14];return this};vec3.transformMat3=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val;this.x=x*m[0]+y*m[3]+z*m[6];this.y=x*m[1]+y*m[4]+z*m[7];this.z=x*m[2]+y*m[5]+z*m[8];return this};vec3.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this};vec3.project=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val,a00=m[0],a01=m[1],a02=m[2],a03=m[3],a10=m[4],a11=m[5],a12=m[6],a13=m[7],a20=m[8],a21=m[9],a22=m[10],a23=m[11],a30=m[12],a31=m[13],a32=m[14],a33=m[15];var l_w=1/(x*a03+y*a13+z*a23+a33);this.x=(x*a00+y*a10+z*a20+a30)*l_w;this.y=(x*a01+y*a11+z*a21+a31)*l_w;this.z=(x*a02+y*a12+z*a22+a32)*l_w;return this};vec3.unproject=function(viewport,invProjectionView){var viewX=viewport.x,viewY=viewport.y,viewWidth=viewport.z,viewHeight=viewport.w;var x=this.x,y=this.y,z=this.z;x=x-viewX;y=viewHeight-y-1;y=y-viewY;this.x=2*x/viewWidth-1;this.y=2*y/viewHeight-1;this.z=2*z-1;return this.project(invProjectionView)};vec3.random=function(scale){scale=scale||1;var r=Math.random()*2*Math.PI;var z=Math.random()*2-1;var zScale=Math.sqrt(1-z*z)*scale;this.x=Math.cos(r)*zScale;this.y=Math.sin(r)*zScale;this.z=z*scale;return this};vec3.reset=function(){this.x=0;this.y=0;this.z=0;return this};vec3.sub=vec3.subtract;vec3.mul=vec3.multiply;vec3.div=vec3.divide;vec3.dist=vec3.distance;vec3.distSq=vec3.distanceSq;vec3.len=vec3.length;vec3.lenSq=vec3.lengthSq;vec3.toString=function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"};vec3.str=vec3.toString;module.exports=Vector3},{}],30:[function(require,module,exports){var common=require("./common");function Vector4(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}}var vec4=Vector4.prototype;for(var k in common){vec4[k]=common[k]}vec4.clone=function(){return new Vector4(this.x,this.y,this.z,this.w)};vec4.multiply=function(v){this.x*=v.x;this.y*=v.y;this.z*=v.z;this.w*=v.w;return this};vec4.divide=function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;this.w/=v.w;return this};vec4.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z,dw=v.w-this.w;return Math.sqrt(dx*dx+dy*dy+dz*dz+dw*dw)};vec4.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z,dw=v.w-this.w;return dx*dx+dy*dy+dz*dz+dw*dw};vec4.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};vec4.transformMat4=function(mat){var m=mat.val,x=this.x,y=this.y,z=this.z,w=this.w;this.x=m[0]*x+m[4]*y+m[8]*z+m[12]*w;this.y=m[1]*x+m[5]*y+m[9]*z+m[13]*w;this.z=m[2]*x+m[6]*y+m[10]*z+m[14]*w;this.w=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return this};vec4.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this};vec4.random=function(scale){scale=scale||1;this.x=(Math.random()*2-1)*scale;this.y=(Math.random()*2-1)*scale;this.z=(Math.random()*2-1)*scale;this.w=(Math.random()*2-1)*scale;return this};vec4.reset=function(){this.x=0;this.y=0;this.z=0;this.w=0;return this};vec4.sub=vec4.subtract;vec4.mul=vec4.multiply;vec4.div=vec4.divide;vec4.dist=vec4.distance;vec4.distSq=vec4.distanceSq;vec4.len=vec4.length;vec4.lenSq=vec4.lengthSq;vec4.toString=function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};vec4.str=vec4.toString;module.exports=Vector4},{"./common":31}],31:[function(require,module,exports){module.exports={copy:function(otherVec){this.x=otherVec.x||0;this.y=otherVec.y||0;this.z=otherVec.z||0;this.w=otherVec.w||0;return this},set:function(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}return this},add:function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},subtract:function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},scale:function(s){this.x*=s;this.y*=s;this.z*=s;this.w*=s;return this},length:function(){var x=this.x,y=this.y,z=this.z,w=this.w;return Math.sqrt(x*x+y*y+z*z+w*w)},lengthSq:function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},normalize:function(){var x=this.x,y=this.y,z=this.z,w=this.w;var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len;this.w=w*len}return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lerp:function(v,t){var ax=this.x,ay=this.y,az=this.z,aw=this.w;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);this.w=aw+t*(v.w-aw);return this}}},{}],32:[function(require,module,exports){module.exports={Vector2:require("./Vector2"),Vector3:require("./Vector3"),Vector4:require("./Vector4"),Matrix3:require("./Matrix3"),Matrix4:require("./Matrix4"),Quaternion:require("./Quaternion")}},{"./Matrix3":25,"./Matrix4":26,"./Quaternion":27,"./Vector2":28,"./Vector3":29,"./Vector4":30}],33:[function(require,module,exports){var Class=require("klasse");var Constraint=new Class({initialize:function(p1,p2,restingDistance,stiffness,tearDistance){this.p1=p1;this.p2=p2;this.stiffness=stiffness||1;this.tearDistance=tearDistance;if(typeof restingDistance==="undefined"||restingDistance!==0&&!restingDistance){this.restingDistance=this.p1.position.distance(this.p2.position)}else{this.restingDistance=restingDistance}},solve:function(){var p1vec=this.p1.position;var p2vec=this.p2.position;var dx=p1vec.x-p2vec.x;var dy=p1vec.y-p2vec.y;var dz=p1vec.z-p2vec.z;var d=Math.sqrt(dx*dx+dy*dy+dz*dz);if(this.tearDistance&&d>this.tearDistance){this.p1.removeConstraint(this)}var restingRatio=d===0?this.restingDistance:(this.restingDistance-d)/d;var im1=1/this.p1.mass;var im2=1/this.p2.mass;var scalarP1=im1/(im1+im2)*this.stiffness;var scalarP2=this.stiffness-scalarP1;p1vec.x+=dx*scalarP1*restingRatio;p1vec.y+=dy*scalarP1*restingRatio;p1vec.z+=dz*scalarP1*restingRatio;p2vec.x-=dx*scalarP2*restingRatio;p2vec.y-=dy*scalarP2*restingRatio;p2vec.z-=dz*scalarP2*restingRatio}});module.exports=Constraint},{klasse:37}],34:[function(require,module,exports){var Class=require("klasse");var Vector3=require("vecmath").Vector3;var Constraint=require("./Constraint");var PointMass=new Class({initialize:function(x,y,z,mass){this.position=new Vector3(x,y,z);this.lastPosition=new Vector3(x,y,z);this.acceleration=new Vector3(0,0,0);this.velocity=new Vector3(0,0,0);this.pinPosition=null;this.pinned=false;this.isWeakPin=false;this.mass=mass||1;this.constraints=[]},addForce:function(vec){var a=this.acceleration;a.x+=vec.x/this.mass;a.y+=vec.y/this.mass;a.z+=vec.z/this.mass},attach:function(point,restingDistance,stiffness,tearDistance){var c=new Constraint(this,point,restingDistance,stiffness,tearDistance);this.addConstraint(c);return c},addConstraint:function(constraint){this.constraints.push(constraint)},removeConstraint:function(constraint){var i=this.constraints.length;while(i--){if(this.constraints[i]===constraint)this.constraints.splice(i,1)}},pin:function(x,y,z,weak){if(this.pinPosition===null)this.pinPosition=new Vector3;this.pinPosition.x=x;this.pinPosition.y=y;this.pinPosition.z=z;this.pinned=true;this.isWeakPin=!!weak},unpin:function(){this.pinned=false;this.isWeakPin=false},solveConstraints:function(world){for(var i=0;i<this.constraints.length;i++)this.constraints[i].solve()}});module.exports=PointMass},{"./Constraint":33,klasse:37,vecmath:47}],35:[function(require,module,exports){var Class=require("klasse");var Vector3=require("vecmath").Vector3;var Vector2=require("vecmath").Vector2;var PointMass=require("./PointMass");var Constraint=require("./Constraint");var distSq=require("minimath").distanceSq;var World=new Class({initialize:function(gravity){this.gravity=gravity||new Vector3(0,1200,0);this.friction=.99;this.bounds=null;this.accuracy=2;this.points=[];this.move=new PointMass(0,0,0);this.tear=new PointMass(0,0,0);this.tearInfluenceSq=0;this.moveInfluenceSq=0;this.tear3D=false;this._pinRemoveInfluenceSq=0;this.moveScalar=1.8;this.maxMoveSq=0;this.obstacles=[];this.groundFriction=1;this.floor=null;this.bounds=null},setPinRemoveInfluence:function(influence){this._pinRemoveInfluenceSq=influence*influence},addPoint:function(pointMass){this.points.push(pointMass)},addPoints:function(pointsArray){for(var i=0;i<pointsArray.length;i++){this.points.push(pointsArray[i])}},applyMotion:function(x,y,z,influence,scalar,maxDist){this.moveInfluenceSq=influence*influence;this.moveScalar=scalar||1.8;var mov=this.move.position;mov.x=x;mov.y=y;mov.z=z;if(maxDist===0){this.maxMoveSq=0}else{maxDist=+(maxDist||100);this.maxMoveSq=maxDist*maxDist}},applyTear:function(x,y,z,influence){this.tearInfluenceSq=influence*influence;var tpos=this.tear.position;tpos.x=x;tpos.y=y;tpos.z=z},_handleInteractions:function(){if(this.moveInfluenceSq!==0||this.tearInfluenceSq!==0){for(var i=0;i<this.points.length;i++){var p=this.points[i];var movePos=this.move.position;var tearPos=this.tear.position;var otherPos=p.position;var mvec=movePos;var tvec=tearPos;var ovec=otherPos;var moveDistSq,tearDistSq;if(this.tear3D){moveDistSq=mvec.distSq(ovec);tearDistSq=tvec.distSq(ovec)}else{moveDistSq=distSq(mvec.x,mvec.y,ovec.x,ovec.y);tearDistSq=distSq(tvec.x,tvec.y,ovec.x,ovec.y)}if(this.moveInfluenceSq!==0&&moveDistSq<this.moveInfluenceSq){var op=this.move.lastPosition;var mAmtX=mvec.x-op.x;var mAmtY=mvec.y-op.y;var mAmtZ=mvec.z-op.z;var max=0;var lenSq=mAmtX*mAmtX+mAmtY*mAmtY+mAmtZ*mAmtZ;if(this.maxMoveSq===0||lenSq<this.maxMoveSq){mAmtX*=this.moveScalar;mAmtY*=this.moveScalar;mAmtZ*=this.moveScalar;p.lastPosition.x=p.position.x-mAmtX;p.lastPosition.y=p.position.y-mAmtY;p.lastPosition.z=p.position.z-mAmtZ;if(p.isWeakPin){p.unpin()}}}else if(this._pinRemoveInfluenceSq!==0&&moveDistSq<this._pinRemoveInfluenceSq){if(p.isWeakPin)p.unpin()}if(this.tearInfluenceSq!==0&&tearDistSq<this.tearInfluenceSq){p.constraints=[]}}}},_solveConstraints:function(){var i=this.accuracy;while(i--){for(var j=0;j<this.points.length;j++){this.points[j].solveConstraints(this)}}},_integrate:function(delta){for(var i=0;i<this.points.length;i++){var p=this.points[i];p.addForce(this.gravity);var posvec=p.position;var lastvec=p.lastPosition;var accelvec=p.acceleration;var vx=posvec.x-lastvec.x;var vy=posvec.y-lastvec.y;var vz=posvec.z-lastvec.z;vx*=this.friction;vy*=this.friction;vz*=this.friction;p.velocity.x=vx;p.velocity.y=vy;p.velocity.z=vz;var len2=vx*vx+vy*vy+vz*vz;if(this.floor!==null&&p.position.y>=this.floor&&len2>1e-6){var m=Math.sqrt(len2);if(m!=0){vx/=m;vy/=m}vx*=m*this.groundFriction;vy*=m*this.groundFriction}var tSqr=delta*delta;var nx=posvec.x+vx+.5*accelvec.x*tSqr;var ny=posvec.y+vy+.5*accelvec.y*tSqr;var nz=posvec.z+vz+.5*accelvec.z*tSqr;lastvec.x=posvec.x;lastvec.y=posvec.y;lastvec.z=posvec.z;posvec.x=nx;posvec.y=ny;posvec.z=nz;accelvec.x=0;accelvec.y=0;accelvec.z=0}},_setPins:function(){for(var i=0;i<this.points.length;i++){var p=this.points[i];if(p.pinned&&p.pinPosition!==null){p.position.x=p.pinPosition.x;p.position.y=p.pinPosition.y;p.position.z=p.pinPosition.z}}},step:function(delta){this._solveConstraints();this._handleInteractions();this._integrate(delta);this._setPins();this.move.lastPosition.x=this.move.position.x;this.move.lastPosition.y=this.move.position.y;this.move.lastPosition.z=this.move.position.z;this.tear.lastPosition.x=this.tear.position.x;this.tear.lastPosition.y=this.tear.position.y;this.tear.lastPosition.z=this.tear.position.z;this.moveInfluenceSq=this.tearInfluenceSq=0}});module.exports=World},{"./Constraint":33,"./PointMass":34,klasse:37,minimath:39,vecmath:47}],36:[function(require,module,exports){module.exports={World:require("./World"),Constraint:require("./Constraint"),PointMass:require("./PointMass")}},{"./Constraint":33,"./PointMass":34,"./World":35}],37:[function(require,module,exports){module.exports=require(23)},{}],38:[function(require,module,exports){var Rectangle=function(x,y,width,height){this.x=x||0;this.y=y||0;this.width=width||0;this.height=height||0};Rectangle.prototype.constructor=Rectangle;module.exports=Rectangle},{}],39:[function(require,module,exports){var distanceSq=function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return dx*dx+dy*dy};module.exports={random:function(start,end){return start+Math.random()*(end-start)},lerp:function(v0,v1,t){return v0*(1-t)+v1*t},smoothstep:function(v0,v1,t){t=Math.max(0,Math.min(1,(t-v0)/(v1-v0)));return t*t*(3-2*t)},distanceSq:distanceSq,distance:function(x1,y1,x2,y2){return Math.sqrt(distanceSq(x1,y1,x2,y2))},shuffle:function(array){var counter=array.length,temp,index;while(counter--){index=Math.random()*counter|0;temp=array[counter];array[counter]=array[index];array[index]=temp}return array},Rectangle:require("./Rectangle")}},{"./Rectangle":38}],40:[function(require,module,exports){module.exports=require(25)},{}],41:[function(require,module,exports){module.exports=require(26)},{}],42:[function(require,module,exports){module.exports=require(27)},{"./Matrix3":40,"./Vector3":44,"./common":46}],43:[function(require,module,exports){module.exports=require(28)},{}],44:[function(require,module,exports){module.exports=require(29)},{}],45:[function(require,module,exports){module.exports=require(30)},{"./common":46}],46:[function(require,module,exports){module.exports=require(31)},{}],47:[function(require,module,exports){arguments[4][32][0].apply(exports,arguments)},{"./Matrix3":40,"./Matrix4":41,"./Quaternion":42,"./Vector2":43,"./Vector3":44,"./Vector4":45}],48:[function(require,module,exports){var Vector3=require("vecmath").Vector3;var World=require("verlet3d").World;var Constraint=require("verlet3d").Constraint;var PointMass=require("verlet3d").PointMass;var Cloth=require("./lib/Cloth");var ClothRenderer=require("./lib/ClothRenderer");var WebGLContext=require("kami").WebGLContext;var ShaderProgram=require("kami").ShaderProgram;var Texture=require("kami").Texture;var domready=require("domready");var raf=require("raf.js");var fs=require("fs");var vert="attribute vec4 Position;\nattribute vec4 Color;\nattribute vec3 Normal;\nattribute vec2 TexCoord0;\n\nuniform mat4 u_projModelView;\nuniform float time;\n\nvarying vec4 v_col;\nvarying vec2 v_texCoord0;\nvarying vec3 v_normal;\n\nuniform mat3 rot;\n\nvoid main() {\n	gl_Position = u_projModelView * vec4(Position.xy, 0.0, 1.0);\n\n	v_col = Color;\n	v_normal = Normal;\n	v_texCoord0 = TexCoord0;\n}";var frag='#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_col;\nvarying vec3 v_normal;\nvarying vec2 v_texCoord0;\n\nuniform sampler2D u_sampler0;\nuniform sampler2D u_sampler1;\n\n//values used for shading algorithm...\nuniform vec2 Resolution;      //resolution of screen\nuniform vec3 LightPos;        //light position, normalized\nuniform vec4 LightColor;      //light RGBA -- alpha is intensity\nuniform vec4 AmbientColor;    //ambient RGBA -- alpha is intensity \nuniform vec3 Falloff;         //attenuation coefficients\n\nvoid main() {\n    //this could easily be an image ... \n	vec4 diffuseColor = v_col; //* texture2D(u_sampler0, v_texCoord0);\n    vec2 check = mod(v_texCoord0.xy * Resolution.xy, vec2(100));\n\n    float noise = texture2D(u_sampler1, v_texCoord0 * 3.0).r;\n\n    if (check.x < 50.0)\n        diffuseColor = vec4(0.2,0.3,0.5,1.0);\n    \n    diffuseColor += noise * 0.2;\n\n    //The delta position of light\n    vec3 LightDir = vec3(LightPos.xy - (gl_FragCoord.xy / Resolution.xy), LightPos.z);\n\n    //Correct for aspect ratio\n    LightDir.x *= Resolution.x / Resolution.y;\n\n    //Determine distance (used for attenuation) BEFORE we normalize our LightDir\n    float D = length(LightDir);\n\n    // diffuseColor.r = smoothstep(0.5, 0.55, D);\n\n    //normalize our vectors\n    vec3 N = normalize(v_normal);\n    vec3 L = normalize(LightDir);\n\n    //Pre-multiply light color with intensity\n    //Then perform "N dot L" to determine our Diffuse term\n    vec3 Diffuse = (LightColor.rgb * LightColor.a) * max(dot(N, L), 0.0);\n\n\n    //pre-multiply ambient color with intensity\n    vec3 Ambient = AmbientColor.rgb * AmbientColor.a;\n\n    //calculate attenuation\n    float Attenuation = 1.0 / ( Falloff.x + (Falloff.y*D) + (Falloff.z*D*D) );\n    // float Attenuation = D;\n\n    //the calculation which brings it all together\n    vec3 Intensity = Ambient + Diffuse * Attenuation;\n    vec3 FinalColor = diffuseColor.rgb * Intensity;\n    gl_FragColor = v_col * vec4(FinalColor, diffuseColor.a);\n    // gl_FragColor = vec4(vec3(v_texCoord0.x), 1.0);\n}';domready(function(){var width=window.innerWidth;var height=window.innerHeight;
var canvas=document.createElement("canvas");document.body.style.margin="0";document.body.style.background="black";document.body.style.overflow="hidden";document.body.appendChild(canvas);var context=new WebGLContext(width,height,canvas,{transparent:false,antialias:true});var mouseInfluence=15;var mouseScale=.25;var mouseMaxDist=20;var steps=60;var mouseTearInfluence=4;var gravity=0;var useFloor=false;var world=new World(new Vector3(0,0,0));world.removablePins=true;var cloth=new Cloth(512,256,{spacing:8,stiffness:.01});world.addPoints(cloth.points);var mouseDown=false;window.addEventListener("mousedown",function(ev){if(ev.which==1)mouseDown=true});window.addEventListener("mouseup",function(ev){if(ev.which==1)mouseDown=false});window.addEventListener("keydown",function(ev){if(ev.keyCode===32){world.points.length=0;cloth.create();world.addPoints(cloth.points)}});var texture,renderer,noiseTexture;var lightZ=.45;setupGL();function randomNoise(){var w=cloth.width,h=cloth.height;var noise=new Uint8Array(w*h*4);for(var i=0;i<noise.length;i++){noise[i]=Math.floor(Math.random()*255)}var noiseTex=new Texture(context,w,h,Texture.Format.RGBA,Texture.DataType.UNSIGNED_BYTE,noise);noiseTex.setFilter(Texture.Filter.LINEAR);noiseTex.setWrap(Texture.Wrap.REPEAT);return noiseTex}function setupGL(){renderer=new ClothRenderer(context,vert,frag);texture=new Texture(context,getURL(),render);texture.setFilter(Texture.Filter.LINEAR);texture.setWrap(Texture.Wrap.REPEAT);noiseTexture=randomNoise();renderer.lightPosition.set(0,0,lightZ)}function render(){requestAnimationFrame(render);world.step(.016);var gl=context.gl;noiseTexture.bind(1);texture.bind(0);gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);renderer.draw(world,cloth.cols,cloth.rows)}var time=0;window.addEventListener("mousemove",function(ev){renderer.lightPosition.set(ev.clientX/width,1-ev.clientY/height,lightZ);var z=Math.sin(time+=.01)*50;if(mouseDown){world.applyTear(ev.clientX,ev.clientY,z,mouseTearInfluence);world.applyMotion(ev.clientX,ev.clientY,z,mouseInfluence,mouseScale,mouseMaxDist)}else world.applyMotion(ev.clientX,ev.clientY,z,mouseInfluence,mouseScale,mouseMaxDist)});function getURL(){return"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}})},{"./lib/Cloth":1,"./lib/ClothRenderer":2,domready:8,fs:49,kami:20,"raf.js":24,vecmath:32,verlet3d:36}],49:[function(require,module,exports){},{}]},{},[48]);